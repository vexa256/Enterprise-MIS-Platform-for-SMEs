!function(){"use strict";var e,t,n,r,o,i,a,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=function(e){return function(t){return r=typeof(n=t),(null===n?"null":"object"==r&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":r)===e;var n,r}},c=function(e){return function(t){return typeof t===e}},l=s("string"),f=s("object"),d=s("array"),m=c("boolean"),p=c("function"),g=c("number"),v=function(){},h=function(e){return function(){return e}},y=function(e){return function(t){return!e(t)}},S=h(!1),C=h(!0),b=function(){return O},O=(e=function(e){return e.isNone()},{fold:function(e,t){return e()},is:S,isSome:S,isNone:C,getOr:n=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:h(null),getOrUndefined:h(void 0),or:n,orThunk:t,map:b,each:v,bind:b,exists:S,forall:C,filter:b,equals:e,equals_:e,toArray:function(){return[]},toString:h("none()")}),N=function(e){var t=h(e),n=function(){return o},r=function(t){return t(e)},o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:C,isNone:S,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return N(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?o:O},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(S,(function(t){return n(e,t)}))}};return o},L={some:N,none:b,from:function(e){return null==e?O:N(e)}},T=Array.prototype.slice,A=Array.prototype.push,x=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o)}return r},k=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},w=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r)&&n.push(i)}return n},D=function(e,t,n){return k(e,(function(e){n=t(n,e)})),n},E=function(e,t,n){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(t(i,r))return L.some(i);if(n(i,r))break}return L.none()},B=function(e,t){return E(e,t,S)},I=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!d(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);A.apply(t,e[n])}return t}(x(e,t))},P=function(e){var t=T.call(e,0);return t.reverse(),t},R=function(e,t){return 0<=t&&t<e.length?L.some(e[t]):L.none()},M=function(e){return R(e,0)},U=function(e){return R(e,e.length-1)},_=function(){return(_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},$=function(){return F(0,0)},F=function(e,t){return{major:e,minor:t}},j=function(e,t){var n=String(t).toLowerCase();return 0===e.length?$():function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return F(r(1),r(2))}(e,n)},q=$,H=function(e,t){var n=String(t).toLowerCase();return B(e,(function(e){return e.search(n)}))},K=function(e,t){return-1!==e.indexOf(t)},V=(r=/^\s+|\s+$/g,function(e){return e.replace(r,"")}),W=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Q=function(e){return function(t){return K(t,e)}},X=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return K(e,"edge/")&&K(e,"chrome")&&K(e,"safari")&&K(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,W],search:function(e){return K(e,"chrome")&&!K(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return K(e,"msie")||K(e,"trident")}},{name:"Opera",versionRegexes:[W,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Q("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Q("firefox")},{name:"Safari",versionRegexes:[W,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(K(e,"safari")||K(e,"mobile/"))&&K(e,"applewebkit")}}],z=[{name:"Windows",search:Q("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return K(e,"iphone")||K(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Q("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Q("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Q("linux"),versionRegexes:[]},{name:"Solaris",search:Q("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Q("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Q("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Y={browsers:h(X),oses:h(z)},Z="Firefox",G=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isEdge:r("Edge"),isChrome:r("Chrome"),isIE:r("IE"),isOpera:r("Opera"),isFirefox:r(Z),isSafari:r("Safari")}},J=function(){return G({current:void 0,version:q()})},ee=G,te=(h("Edge"),h("Chrome"),h("IE"),h("Opera"),h(Z),h("Safari"),"Windows"),ne="Android",re="Solaris",oe="FreeBSD",ie="ChromeOS",ae=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isWindows:r(te),isiOS:r("iOS"),isAndroid:r(ne),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(re),isFreeBSD:r(oe),isChromeOS:r(ie)}},ue=function(){return ae({current:void 0,version:q()})},se=ae,ce=(h(te),h("iOS"),h(ne),h("Linux"),h("OSX"),h(re),h(oe),h(ie),function(e,t){var n,r,o,i,a,u,s,c,l,f,d,m,p=Y.browsers(),g=Y.oses(),v=function(e,t){return H(e,t).map((function(e){var n=j(e.versionRegexes,t);return{current:e.name,version:n}}))}(p,e).fold(J,ee),y=function(e,t){return H(e,t).map((function(e){var n=j(e.versionRegexes,t);return{current:e.name,version:n}}))}(g,e).fold(ue,se);return{browser:v,os:y,deviceType:(r=v,o=e,i=t,a=(n=y).isiOS()&&!0===/ipad/i.test(o),u=n.isiOS()&&!a,s=n.isiOS()||n.isAndroid(),c=s||i("(pointer:coarse)"),l=a||!u&&s&&i("(min-device-width:768px)"),f=u||s&&!l,d=r.isSafari()&&n.isiOS()&&!1===/safari/i.test(o),m=!f&&!l&&!d,{isiPad:h(a),isiPhone:h(u),isTablet:h(l),isPhone:h(f),isTouch:h(c),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:h(d),isDesktop:h(m)})}}),le=function(e){return window.matchMedia(e).matches},fe=(a=!(o=function(){return ce(navigator.userAgent,le)}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a||(a=!0,i=o.apply(null,e)),i}),de=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},me=function(e,t){var n=(t||document).createElement(e);return de(n)},pe=de,ge=function(e,t){return e.dom===t.dom},ve=function(e,t){return fe().browser.isIE()?function(e,t){return n=e.dom,r=t.dom,o=Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(n.compareDocumentPosition(r)&o);var n,r,o}(e,t):(n=t,(r=e.dom)!==(o=n.dom)&&r.contains(o));var n,r,o},he=function(e,t){var n=e.dom;if(1!==n.nodeType)return!1;var r=n;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},ye=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),Se=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Ce=tinymce.util.Tools.resolve("tinymce.util.VK"),be=Object.keys,Oe=function(e,t){for(var n=be(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i)}},Ne=("undefined"!=typeof window||Function("return this;")(),function(e){return e.dom.nodeName.toLowerCase()}),Le=(1,function(e){return 1===e.dom.nodeType}),Te=function(e,t){var n=e.dom;Oe(t,(function(e,t){!function(e,t,n){if(!(l(n)||m(n)||g(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")}(n,t,e)}))},Ae=function(e){return D(e.dom.attributes,(function(e,t){return e[t.name]=t.value,e}),{})},xe=function(e){return L.from(e.dom.parentNode).map(pe)},ke=function(e){return x(e.dom.childNodes,pe)},we=function(e,t){var n=e.dom.childNodes;return L.from(n[t]).map(pe)},De=function(e){return we(e,0)},Ee=function(e){return we(e,e.dom.childNodes.length-1)},Be=function(e,t){xe(e).each((function(n){n.dom.insertBefore(t.dom,e.dom)}))},Ie=function(e,t){e.dom.appendChild(t.dom)},Pe=function(e,t){k(t,(function(t){Ie(e,t)}))},Re=function(e){var t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},Me=function(e){return!0,pe(e.dom.cloneNode(true))},Ue=function(e,t){var n,r,o,i=(n=e,r=me(t),o=Ae(n),Te(r,o),r);Be(e,i);var a=ke(e);return Pe(i,a),Re(e),i},_e=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),$e=tinymce.util.Tools.resolve("tinymce.util.Tools"),Fe=function(e){return function(t){return t&&t.nodeName.toLowerCase()===e}},je=function(e){return function(t){return t&&e.test(t.nodeName)}},qe=function(e){return e&&3===e.nodeType},He=je(/^(OL|UL|DL)$/),Ke=je(/^(OL|UL)$/),Ve=Fe("ol"),We=je(/^(LI|DT|DD)$/),Qe=je(/^(DT|DD)$/),Xe=je(/^(TH|TD)$/),ze=Fe("br"),Ye=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},Ze=function(e,t){return e&&e.nodeName in t},Ge=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},Je=function(e,t){return e.isChildOf(t,e.getRoot())},et=function(e,t){var n,r,o,i,a=e.dom,u=e.schema.getBlockElements(),s=a.createFragment(),c=!1===(n=e.getParam("forced_root_block","p"))?"":!0===n?"p":n;if(c&&((o=a.create(c)).tagName===c.toUpperCase()&&a.setAttribs(o,e.getParam("forced_root_block_attrs",{})),Ze(t.firstChild,u)||s.appendChild(o)),t)for(;r=t.firstChild;){var l=r.nodeName;i||"SPAN"===l&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),Ze(r,u)?(s.appendChild(r),o=null):c?(o||(o=a.create(c),s.appendChild(o)),o.appendChild(r)):s.appendChild(r)}return c?i||o.appendChild(a.create("br",{"data-mce-bogus":"1"})):s.appendChild(a.create("br")),s},tt=_e.DOM,nt=function(e){he(e,"dt")&&Ue(e,"dd")},rt=function(e,t){if(qe(e))return{container:e,offset:t};var n=ye.getNode(e,t);return qe(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&qe(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&qe(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},ot=function(e){var t=e.cloneRange(),n=rt(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=rt(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t},it=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),at=function(e,t){var n=t||e.selection.getStart(!0);return e.dom.getParent(n,"OL,UL,DL",st(e,n))},ut=function(e){var t,n,r,o=e.selection.getSelectedBlocks();return $e.grep((t=e,n=o,r=$e.map(n,(function(e){return t.dom.getParent(e,"li,dd,dt",st(t,e))||e})),it.unique(r)),(function(e){return We(e)}))},st=function(e,t){var n=e.dom.getParents(t,"TD,TH");return 0<n.length?n[0]:e.getBody()},ct=function(e,t){var n=e.dom.getParents(t,"ol,ul",st(e,t));return U(n)},lt=function(e,t){var n=x(t,(function(t){return ct(e,t).getOr(t)}));return it.unique(n)},ft=function(e,t,n){return e.isSome()&&t.isSome()?L.some(n(e.getOrDie(),t.getOrDie())):L.none()},dt=function(e,t,n){return e.fire("ListMutation",{action:t,element:n})},mt=function(e,t,n){if(!l(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);var r;void 0!==(r=e).style&&p(r.style.getPropertyValue)&&e.style.setProperty(t,n)},pt=function(e,t){Ie(e.item,t.list)},gt=function(e,t,n){var r=t.slice(0,n.depth);return U(r).each((function(t){var r,o,i,a,u,s,c,l;s=(r=e,o=n.itemAttributes,i=n.content,a=me("li",r),Te(a,o),Pe(a,i),a),Ie((u=t).list,s),u.item=s,l=n,Ne((c=t).list)!==l.listType&&(c.list=Ue(c.list,l.listType)),Te(c.list,l.listAttributes)})),r},vt=function(e,t,n){var r,o=function(e,t,n){for(var r,o,i,a=[],u=0;u<n;u++)a.push((r=e,o=t.listType,i={list:me(o,r),item:me("li",r)},Ie(i.list,i.item),i));return a}(e,n,n.depth-t.length);return function(e){for(var t=1;t<e.length;t++)pt(e[t-1],e[t])}(o),function(e,t){for(var n,r=0;r<e.length-1;r++)n=e[r].item.dom,mt(n,"list-style-type","none");U(e).each((function(e){Te(e.list,t.listAttributes),Te(e.item,t.itemAttributes),Pe(e.item,t.content)}))}(o,n),r=o,ft(U(t),M(r),pt),t.concat(o)},ht=function(e){return he(e,"OL,UL")},yt=function(e){return De(e).map(ht).getOr(!1)},St=function(e){return 0<e.depth},Ct=function(e){return e.isSelected},bt=function(e){var t=ke(e),n=Ee(e).map(ht).getOr(!1)?t.slice(0,-1):t;return x(n,Me)},Ot=function(e){return k(e,(function(t,n){var r,o,i,a,u;i=(r=e)[o=n].depth,a=function(e){return e.depth===i&&!e.dirty},u=function(e){return e.depth<i},E(P(r.slice(0,o)),a,u).orThunk((function(){return E(r.slice(o+1),a,u)})).fold((function(){var e;t.dirty&&((e=t).listAttributes=function(e,t){var n,r,o,i,a={};return n=t,i=a,r=function(e,t){i[t]=e},o=v,Oe(e,(function(e,t){(n(e,t)?r:o)(e,t)})),a}(e.listAttributes,(function(e,t){return"start"!==t})))}),(function(e){return r=e,(n=t).listType=r.listType,void(n.listAttributes=_({},r.listAttributes));var n,r}))})),e},Nt=function(e,t,n,r){return De(r).filter(ht).fold((function(){t.each((function(e){ge(e.start,r)&&n.set(!0)}));var o,i,a,u=(o=r,i=e,a=n.get(),xe(o).filter(Le).map((function(e){return{depth:i,dirty:!1,isSelected:a,content:bt(o),itemAttributes:Ae(o),listAttributes:Ae(e),listType:Ne(e)}})));t.each((function(e){ge(e.end,r)&&n.set(!1)}));var s=Ee(r).filter(ht).map((function(r){return Lt(e,t,n,r)})).getOr([]);return u.toArray().concat(s)}),(function(r){return Lt(e,t,n,r)}))},Lt=function(e,t,n,r){return I(ke(r),(function(r){return(ht(r)?Lt:Nt)(e+1,t,n,r)}))},Tt=function(e,t){var n=Ot(t);return x(n,(function(t){var n,r,o=(n=t.content,r=document.createDocumentFragment(),k(n,(function(e){r.appendChild(e.dom)})),pe(r));return pe(et(e,o.dom))}))},At=function(e,t){var n,r,o=Ot(t);return n=e.contentDocument,r=D(o,(function(e,t){return(t.depth>e.length?vt:gt)(n,e,t)}),[]),M(r).map((function(e){return e.list})).toArray()},xt=function(e,t,n){var r,o=function(e,t){var n,r=(n=!1,{get:function(){return n},set:function(e){n=e}});return x(e,(function(e){return{sourceList:e,entries:Lt(0,t,r,e)}}))}(t,(r=x(ut(e),pe),ft(B(r,y(yt)),B(P(r),y(yt)),(function(e,t){return{start:e,end:t}}))));k(o,(function(t){var r,o;r=t.entries,o=n,k(w(r,Ct),(function(e){return function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0}(o,e),0}));var i,a,u,s=(i=e,a=t.entries,I(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,a=e.length;i<a;i++){var u=e[i],s=t(u);s!==n&&(r.push(o),o=[]),n=s,o.push(u)}return 0!==o.length&&r.push(o),r}(a,St),(function(e){return(M(e).map(St).getOr(!1)?At:Tt)(i,e)})));k(s,(function(t){dt(e,"Indent"===n?"IndentList":"OutdentList",t.dom)})),u=t.sourceList,k(s,(function(e){Be(u,e)})),Re(t.sourceList)}))},kt=function(e,t){var n,r,o=x(function(e){var t,n,r,o=(n=ct(t=e,t.selection.getStart()),r=w(t.selection.getSelectedBlocks(),Ke),n.toArray().concat(r));return lt(e,o)}(e),pe),i=x(w(ut(e),Qe),pe),a=!1;return(o.length||i.length)&&(n=e.selection.getBookmark(),xt(e,o,t),r=e,k(i,"Indent"===t?nt:function(e){return function(e,t){he(t,"dd")?Ue(t,"dt"):he(t,"dt")&&xe(t).each((function(n){return function(e,t,n){var r=tt.select('span[data-mce-type="bookmark"]',t),o=et(e,n),i=tt.createRng();i.setStartAfter(n),i.setEndAfter(t);for(var a,u=i.extractContents(),s=u.firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){tt.remove(s);break}e.dom.isEmpty(u)||tt.insertAfter(u,t),tt.insertAfter(o,t),Ge(e.dom,n.parentNode)&&(a=n.parentNode,$e.each(r,(function(e){a.parentNode.insertBefore(e,n.parentNode)})),tt.remove(a)),tt.remove(n),Ge(e.dom,t)&&tt.remove(t)}(e,n.dom,t.dom)}))}(r,e),0}),e.selection.moveToBookmark(n),e.selection.setRng(ot(e.selection.getRng())),e.nodeChanged(),a=!0),a},wt=function(e){return kt(e,"Indent")},Dt=function(e){return kt(e,"Outdent")},Et=function(e){return kt(e,"Flatten")},Bt=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),It=_e.DOM,Pt=function(e){var t={},n=function(n){var r,o=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"];1===o.nodeType&&(r=It.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),n?o.insertBefore(r,o.childNodes[i]):It.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),t[n?"startContainer":"endContainer"]=o,t[n?"startOffset":"endOffset"]=i};return n(!0),e.collapsed||n(),t},Rt=function(e){var t=function(t){var n,r=n=e[t?"startContainer":"endContainer"],o=e[t?"startOffset":"endOffset"];r&&(1===r.nodeType&&(o=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(r),r=r.parentNode,It.remove(n),!r.hasChildNodes()&&It.isBlock(r)&&r.appendChild(It.create("br"))),e[t?"startContainer":"endContainer"]=r,e[t?"startOffset":"endOffset"]=o)};t(!0),t();var n=It.createRng();return n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),ot(n)},Mt=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Ut=function(e){return/\btox\-/.test(e.className)},_t=function(e,t,n){var r=function(e){var r=E(e.parents,He,Xe).filter((function(e){return e.nodeName===t&&!Ut(e)})).isSome();n(r)},o=e.dom.getParents(e.selection.getNode());return r({parents:o}),e.on("NodeChange",r),function(){return e.off("NodeChange",r)}},$t=function(e,t){$e.each(t,(function(t,n){e.setAttribute(n,t)}))},Ft=function(e,t,n){var r,o,i,a,u,s,c;r=e,o=t,a=(i=n)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",a),u=e,$t(s=t,(c=n)["list-attributes"]),$e.each(u.select("li",s),(function(e){$t(e,c["list-item-attributes"])}))},jt=function(e,t,n,r){var o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&ze(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(Ye(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},qt=function(e,t,n){var r,o,i=e.selection.getRng(),a="LI",u=st(e,e.selection.getStart(!0)),s=e.dom;"false"!==s.getContentEditable(e.selection.getNode())&&("DL"===(t=t.toUpperCase())&&(a="DT"),r=Pt(i),o=function(e,t,n){for(var r,o=[],i=e.dom,a=jt(e,t,!0,n),u=jt(e,t,!1,n),s=[],c=a;c&&(s.push(c),c!==u);c=c.nextSibling);return $e.each(s,(function(t){if(Ye(e,t))return o.push(t),void(r=null);if(i.isBlock(t)||ze(t))return ze(t)&&i.remove(t),void(r=null);var a=t.nextSibling;Bt.isBookmarkNode(t)&&(He(a)||Ye(e,a)||!a&&t.parentNode===n)?r=null:(r||(r=i.create("p"),t.parentNode.insertBefore(r,t),o.push(r)),r.appendChild(t))})),o}(e,i,u),$e.each(o,(function(r){var o,i,u,c,l,f,d,m=r.previousSibling,p=r.parentNode;We(p)||(m&&He(m)&&m.nodeName===t&&(l=m,f=n,s.getStyle(l,"list-style-type")===(d=null===(d=f?f["list-style-type"]:"")?"":d))?(o=m,r=s.rename(r,a),m.appendChild(r)):(o=s.create(t),r.parentNode.insertBefore(o,r),o.appendChild(r),r=s.rename(r,a)),i=s,u=r,c=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],$e.each(c,(function(e){var t;return i.setStyle(u,((t={})[e]="",t))})),Ft(s,o,n),Kt(e.dom,o))})),e.selection.setRng(Rt(r)))},Ht=function(e,t,n){return s=n,(u=t)&&s&&He(u)&&u.nodeName===s.nodeName&&(i=t,a=n,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(a,"list-style-type",!0))&&(r=n,t.className===r.className);var r,o,i,a,u,s},Kt=function(e,t){var n,r=t.nextSibling;if(Ht(e,t,r)){for(;n=r.firstChild;)t.appendChild(n);e.remove(r)}if(r=t.previousSibling,Ht(e,t,r)){for(;n=r.lastChild;)t.insertBefore(n,t.firstChild);e.remove(r)}},Vt=function(e){return"list-style-type"in e},Wt=function(e,t,n){var r,o,i,a,u,s,c=at(e),l=function(e){var t,n,r,o=at(e),i=e.selection.getSelectedBlocks();return r=i,(n=o)&&1===r.length&&r[0]===n?(t=o,$e.grep(t.querySelectorAll("ol,ul,dl"),(function(e){return He(e)}))):$e.grep(i,(function(e){return He(e)&&o!==e}))}(e),d=f(n)?n:{};0<l.length?function(e,t,n,r,o){var i,a,u=He(t);u&&t.nodeName===r&&!Vt(o)?Et(e):(qt(e,r,o),i=Pt(e.selection.getRng(!0)),a=u?function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r}([t],n):n,$e.each(a,(function(t){var n,i,a,u,s;n=e,a=r,u=o,(i=t).nodeName!==a?(s=n.dom.rename(i,a),Ft(n.dom,s,u),dt(n,Mt(a),s)):(Ft(n.dom,i,u),dt(n,Mt(a),i))})),e.selection.setRng(Rt(i)))}(e,c,l,t,d):(i=t,a=d,(o=c)!==(r=e).getBody()&&(o?o.nodeName!==i||Vt(a)||Ut(o)?(u=Pt(r.selection.getRng(!0)),Ft(r.dom,o,a),s=r.dom.rename(o,i),Kt(r.dom,s),r.selection.setRng(Rt(u)),qt(r,i,a),dt(r,Mt(i),s)):Et(r):(qt(r,i,a),dt(r,Mt(i),o))))},Qt=_e.DOM,Xt=function(e,t,n,r){var o=t.startContainer,i=t.startOffset;if(qe(o)&&(n?i<o.data.length:0<i))return o;var a=e.schema.getNonEmptyElements();1===o.nodeType&&(o=ye.getNode(o,i));var u,s,c=new Se(o,r);for(n&&(u=e.dom,ze(s=o)&&u.isBlock(s.nextSibling)&&!ze(s.previousSibling)&&c.next());o=c[n?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(a[o.nodeName])return o;if(qe(o)&&0<o.data.length)return o}},zt=function(e,t){var n=t.childNodes;return 1===n.length&&!He(n[0])&&e.isBlock(n[0])},Yt=function(e,t,n){var r,o,i,a=t.parentNode;Je(e,t)&&Je(e,n)&&(He(n.lastChild)&&(r=n.lastChild),a===n.lastChild&&ze(a.previousSibling)&&e.remove(a.previousSibling),(o=n.lastChild)&&ze(o)&&t.hasChildNodes()&&e.remove(o),Ge(e,n,!0)&&e.$(n).empty(),function(e,t,n){var r,o,i,a=zt(e,n)?n.firstChild:n;if(zt(o=e,i=t)&&o.remove(i.firstChild,!0),!Ge(e,t,!0))for(;r=t.firstChild;)a.appendChild(r)}(e,t,n),r&&n.appendChild(r),i=ve(pe(n),pe(t))?e.getParents(t,He,n):[],e.remove(t),k(i,(function(t){Ge(e,t)&&t!==e.getRoot()&&e.remove(t)})))},Zt=function(e,t){var n=e.dom,r=e.selection,o=r.getStart(),i=st(e,o),a=n.getParent(r.getStart(),"LI",i);if(a){var u=a.parentNode;if(u===e.getBody()&&Ge(n,u))return!0;var s=ot(r.getRng()),c=n.getParent(Xt(e,s,t,i),"LI",i);if(c&&c!==a)return e.undoManager.transact((function(){var n;t?function(e,t,n,r){var o,i,a,u,s=e.dom;s.isEmpty(r)?(a=n,u=r,(i=e).dom.$(u).empty(),Yt(i.dom,a,u),i.selection.setCursorLocation(u,0)):(o=Pt(t),Yt(s,n,r),e.selection.setRng(Rt(o)))}(e,s,c,a):(n=a).parentNode.firstChild===n?Dt(e):function(e,t,n,r){var o=Pt(t);Yt(e.dom,n,r);var i=Rt(o);e.selection.setRng(i)}(e,s,a,c)})),!0;if(!c&&!t&&0===s.startOffset&&0===s.endOffset)return e.undoManager.transact((function(){Et(e)})),!0}return!1},Gt=function(e,t){return e.selection.isCollapsed()?Zt(i=e,a=t)||function(e,t){var n=e.dom,r=e.selection.getStart(),o=st(e,r),i=n.getParent(r,n.isBlock,o);if(i&&n.isEmpty(i)){var a=ot(e.selection.getRng()),u=n.getParent(Xt(e,a,t,o),"LI",o);if(u)return e.undoManager.transact((function(){var r,a,s,c;a=i,s=o,c=(r=n).getParent(a.parentNode,r.isBlock,s),r.remove(a),c&&r.isEmpty(c)&&r.remove(c),Kt(n,u.parentNode),e.selection.select(u,!0),e.selection.collapse(t)})),!0}return!1}(i,a):(r=(n=e).selection.getStart(),o=st(n,r),!!(n.dom.getParent(r,"LI,DT,DD",o)||0<ut(n).length)&&(n.undoManager.transact((function(){n.execCommand("Delete"),function(e,t){$e.each($e.grep(e.select("ol,ul",t)),(function(t){var n,r,o,i;n=e,"LI"===(i=(r=t).parentNode).nodeName&&i.firstChild===r&&((o=i.previousSibling)&&"LI"===o.nodeName?(o.appendChild(r),Ge(n,i)&&Qt.remove(i)):Qt.setStyle(i,"listStyleType","none")),He(i)&&(o=i.previousSibling)&&"LI"===o.nodeName&&o.appendChild(r)}))}(n.dom,n.getBody())})),!0));var n,r,o,i,a},Jt=function(e){var t=P(V(e).split("")),n=x(t,(function(e,t){var n=e.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,t)*n}));return D(n,(function(e,t){return e+t}),0)},en=function(e){if(--e<0)return"";var t=e%26,n=Math.floor(e/26);return en(n)+String.fromCharCode("A".charCodeAt(0)+t)},tn=function(e,t){return function(){var n=at(e);return n&&n.nodeName===t}},nn=function(e){e.addCommand("mceListProps",(function(){!function(e){var t,n,r=at(e);Ve(r)&&e.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:(t={start:e.dom.getAttrib(r,"start","1"),listStyleType:L.some(e.dom.getStyle(r,"list-style-type"))},n=parseInt(t.start,10),t.listStyleType.is("upper-alpha")?en(n):t.listStyleType.is("lower-alpha")?en(n).toLowerCase():t.start)},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(t){(function(e){switch(/^[0-9]+$/.test(t=e)?2:/^[A-Z]+$/.test(t)?0:/^[a-z]+$/.test(t)?1:0<t.length?4:3){case 2:return L.some({listStyleType:L.none(),start:e});case 0:return L.some({listStyleType:L.some("upper-alpha"),start:Jt(e).toString()});case 1:return L.some({listStyleType:L.some("lower-alpha"),start:Jt(e).toString()});case 3:return L.some({listStyleType:L.none(),start:""});case 4:return L.none()}var t})(t.getData().start).each((function(t){e.execCommand("mceListUpdate",!1,{attrs:{start:"1"===t.start?"":t.start},styles:{"list-style-type":t.listStyleType.getOr("")}})})),t.close()}})}(e)}))};u.add("lists",(function(e){var t,n,r,o,i;return!1===e.hasPlugin("rtc",!0)?(function(e){var t,n;e.getParam("lists_indent_on_tab",!0)&&(t=e).on("keydown",(function(e){e.keyCode!==Ce.TAB||Ce.metaKeyPressed(e)||t.undoManager.transact((function(){(e.shiftKey?Dt:wt)(t)&&e.preventDefault()}))})),(n=e).on("keydown",(function(e){e.keyCode===Ce.BACKSPACE?Gt(n,!1)&&e.preventDefault():e.keyCode===Ce.DELETE&&Gt(n,!0)&&e.preventDefault()}))}(e),function(e){e.on("BeforeExecCommand",(function(t){var n=t.command.toLowerCase();"indent"===n?wt(e):"outdent"===n&&Dt(e)})),e.addCommand("InsertUnorderedList",(function(t,n){Wt(e,"UL",n)})),e.addCommand("InsertOrderedList",(function(t,n){Wt(e,"OL",n)})),e.addCommand("InsertDefinitionList",(function(t,n){Wt(e,"DL",n)})),e.addCommand("RemoveList",(function(){Et(e)})),nn(e),e.addCommand("mceListUpdate",(function(t,n){var r,o,i;f(n)&&(o=n,i=at(r=e),r.undoManager.transact((function(){f(o.styles)&&r.dom.setStyles(i,o.styles),f(o.attrs)&&Oe(o.attrs,(function(e,t){return r.dom.setAttrib(i,t,e)}))})))})),e.addQueryStateHandler("InsertUnorderedList",tn(e,"UL")),e.addQueryStateHandler("InsertOrderedList",tn(e,"OL")),e.addQueryStateHandler("InsertDefinitionList",tn(e,"DL"))}(e)):nn(e),n=function(e){return function(){return t.execCommand(e)}},(t=e).hasPlugin("advlist")||(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:n("InsertOrderedList"),onSetup:function(e){return _t(t,"OL",e.setActive)}}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:n("InsertUnorderedList"),onSetup:function(e){return _t(t,"UL",e.setActive)}})),o={text:"List properties...",icon:"ordered-list",onAction:function(){return r.execCommand("mceListProps")},onSetup:function(e){return _t(r,"OL",(function(t){return e.setDisabled(!t)}))}},(r=e).ui.registry.addMenuItem("listprops",o),r.ui.registry.addContextMenu("lists",{update:function(e){var t=at(r,e);return Ve(t)?["listprops"]:[]}}),i=e,{backspaceDelete:function(e){Gt(i,e)}}}))}();